**中国农业发展银行云管平台需求规格说明书**



# **1. 引言**

## 1.1 目的

本需求规格说明书，是在当前云管平台产品功能和中国农业发展银行（以下简称“农发行”）云平台建设项目招标需求基础上进一步明确具体使用需求，详细的介绍平台软件的各个功能，为进行后面的实施部署、参数配置、定制开发、测试和最终的投产上线做准备。

## 1.2 背景

农发行基础架构云平台是为服务于农发行未来新型态业务体系而建设的。为实现这个目标，农发行将从自身情况和实际需求出发，做好云平台架构和功能层面的顶层设计，通过“成熟产品+定制开发+按需集成”的方式分阶段建设真正适合农发行的云平台。

本次项目属于第二阶段的第一期，云管理平台建设的主要的工作是通过搭建云管理平台，在实现异构资源池统一管理的基础上，进一步实现用户自服务及虚拟资源自动化部署能力，同时提供监控、告警、权限及组织管理，流程审批，统计分析等自动化的运维服务。

## 1.3 项目招标书中相关云管平台的具体需求

| 序号 | 功能需求           | 功能描述                                                                                                                                                                                                                   |
|------|--------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1    | 基础设施平台管理   | ★支持通过云管平台界面动态添加各种类型的基础设施平台，将异构的虚拟化平台、公有云平台、物理机等进行统一的资源池化管理。                                                                                                      |
|      |                    | ★支持对所纳管基础设施平台进行必要的运维操作，以及查看系统运行任务状态等。                                                                                                                                                  |
| 2    | VMware纳管功能支持 | ★支持同步所纳VMware虚拟化平台的基础管理架构和虚拟资源；支持查看物理宿主机和数据存储各类虚拟资源的性能监控数据。                                                                                                            |
|      |                    | ★支持虚拟资源的各类操作，包括但不限于虚拟主机的启动、关机、重启、VNC连接、加载/卸载硬盘、加入/离开网络、转换成映像、制作备份、回滚等。                                                                                     |
|      |                    | ★支持申请创建虚拟资源，包括但不限于支持申请创建虚拟主机、虚拟硬盘等，申请时支持为资源指定使用期限，并可申请延期。                                                                                                          |
| 3    | 物理主机纳管能力   | ★支持非虚拟化的x86物理主机的统一管理，可以录入或一次性导入存量非虚拟化IT物理主机，添加并维护自定义资产属性信息，可对资产属性进行统计或筛选，并能直接导出筛选结果。                                                         |
| 4    | 云平台管理能力     | ★支持查看所纳管私有云平台的管理服务，以及管理服务的物理拓扑，并能监控管理服务状态和性能指标。                                                                                                                              |
|      |                    | ★支持同步所纳管私有云平台的基础管理架构；同步所纳管私有云平台的存量各类虚拟资源                                                                                                                                            |
|      |                    | ★支持查看所纳管私有云平台的物理宿主机和数据存储的监控数据；支持查看所纳管私有云平台的存量各类虚拟资源的性能监控数据。                                                                                                      |
|      |                    | 支持接受所纳私有云平台的告警信息，并能对告警信息进行备注和处理，支持告警信息的压缩和自定义级别。                                                                                                                           |
| 5    | 运营管理           | ★支持容量规划与建议，对基础设施平台进行容量分析，对虚拟资源使用率进行分析，给出适当操作建议。                                                                                                                              |
|      |                    | ★组织机构管理，支持按照实际运维管理架构设置任意层级的组织机构树，并可对组织机构树进行增、删、改、查操作。                                                                                                                  |
|      |                    | ★用户管理，支持用户的创建、删除、更改所属组织机构、编辑用户信息、重置密码等操作。                                                                                                                                          |
|      |                    | ★角色权限管理，支持多种角色设置，不同角色具有不同权限。                                                                                                                                                                    |
|      |                    | ★审批流程管理，支持自定义任意级别的审批流程，并能为不同类型的申请操作定义不同的审批流程。可提供对应接口，方便企业内部审批系统对接。                                                                                        |
|      |                    | ★项目/业务系统管理，支持创建项目/业务系统，并为项目/业务系统设置资源配额。支持项目/业务系统生命周期管理，可对项目/业务系统进行下线和删除。                                                                                 |
|      |                    | 支持以服务目录方式提供不同基础设施平台的资源抽象方式，支持自定义服务目录的配置项，并可基于服务目录发布云服务。                                                                                                             |
| 6    | 统计分析及报表     | ★支持各类表格数据的筛选和导出下载，方便统计资源用量和二次加工。                                                                                                                                                            |
|      |                    | ★支持基础设施平台维度/项目/业务系统维度/组织机构维度的统计分析报表。                                                                                                                                                       |
|      |                    | 支持总览及仪表盘展示，可为不同角色定义满足该角色需求的总览及仪表盘视图；支持基础设施平台规模、虚拟资源用量、物理资源使用率、虚拟资源超卖比、业务系统排名、资源使用率排名、资源用量趋势、告警统计与趋势等数据的加工及展示。 |
|      |                    | ★支持全部虚拟资源和物理资源的CPU使用率、内存使用率、硬盘使用率排名，并可将性能指标数据导出成csv文件，支持正排序、倒排序。                                                                                                  |
| 7    | 自服务平台         | ★支持申请创建各类虚拟资源，包括虚拟主机、虚拟硬盘、VPC/路由器、私有网络、公网IP、防火墙、负载均衡器、应用集群等。                                                                                                          |
|      |                    | ★支持各类虚拟资源的自动部署，可按照申请单描述的资源配置进行自动部署，也支持管理员手工填写配置信息部署。                                                                                                                    |
| 8    | 运维管理           | ★支持对常用运维脚本进行保存与管理。                                                                                                                                                                                        |
|      |                    | ★支持创建运维任务，选择脚本和虚拟资源，制定运维任务运行计划，并对运维任务进行管理。                                                                                                                                        |
| 9    | 安全审计           | ★支持对所有用户的所有操作日志进行保存及审计，支持对关键安全信息的脱敏。                                                                                                                                                    |
|      |                    | ★支持用户登陆密码的加密保存和传输。                                                                                                                                                                                        |
|      |                    | ★支持用户查看登陆历史，包括登陆IP地址、时间、登陆方式等。                                                                                                                                                                  |
| 10   | 系统管理           | ★支持对产品信息自定义，并可预览修改效果。                                                                                                                                                                                  |
|      |                    | 支持对影响系统运行的运维相关参数进行自定义，如临时文件保存时间、缓存失效时间、用户session失效时间等。                                                                                                                      |
| 11   | 其他非功能性要求   | 系统采用微服务架构进行构建，便于功能模块的变更或新加，以及单个模块的水平扩展。                                                                                                                                             |
|      |                    | ★系统可提供高可用部署，并可进行集群水平扩展，保证系统的稳定运行。                                                                                                                                                          |
|      |                    | ★系统可提供自动化安装或升级脚本，保证系统部署和升级的安全和操作简单。                                                                                                                                                      |



# **2. 云管理平台概述**

## 2.1 架构图

## 2.2 功能列表

### 2.2.1 招标书中的功能对照表

| 序号 | 功能需求           | 功能描述（招标书中）                                                                                                                                                                                                       | 云管理平台功能                                                                                                                                                                                                                                                                            |
|------|--------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1    | 基础设施平台管理   | ★支持通过云管平台界面动态添加各种类型的基础设施平台，将异构的虚拟化平台、公有云平台、物理机等进行统一的资源池化管理。                                                                                                      | 云资源的增删改查，云资源同步操作，云资源目录树，云资源概览，云资源分类查看，                                                                                                                                                                                                              |
|      |                    | ★支持对所纳管基础设施平台进行必要的运维操作，以及查看系统运行任务状态等。                                                                                                                                                  | 支持主机，虚拟机，网络，镜像，存储的基本的操作和查看                                                                                                                                                                                                                                      |
| 2    | VMware纳管功能支持 | ★支持同步所纳VMware虚拟化平台的基础管理架构和虚拟资源；支持查看物理宿主机和数据存储各类虚拟资源的性能监控数据。                                                                                                            | 支持纳管vmware的云资源，支持云资源的增删改查，vmware云资源同步操作, 查看vmware云资源目录树, vmware云资源概览查看主机，存储的使用情况                                                                                                                                                      |
|      |                    | ★支持虚拟资源的各类操作，包括但不限于虚拟主机的启动、关机、重启、VNC连接、加载/卸载硬盘、加入/离开网络、转换成映像、制作备份、回滚等。                                                                                     | 支持vmware虚拟机各种操作，支持虚拟机的开机、关机、重启、重命名、删除、新增网卡、捕获镜像，快照，绑定标签、修改租期                                                                                                                                                                        |
|      |                    | ★支持申请创建虚拟资源，包括但不限于支持申请创建虚拟主机、虚拟硬盘等，申请时支持为资源指定使用期限，并可申请延期。                                                                                                          | 支持自服务方式申请vmware的虚拟机和数据盘，管理员配置虚拟机产品和数据盘，用户选择相应的产品，输入需要的参数和使用期限，系统会发起流程审批，审批通过后，系统自动创建虚拟机或数据盘，在用户的资源列表中可以看到新的虚拟机和数据盘。并可以通过自服务的方式申请延期                            |
| 3    | 物理主机纳管能力   | ★支持非虚拟化的x86物理主机的统一管理，可以录入或一次性导入存量非虚拟化IT物理主机，添加并维护自定义资产属性信息，可对资产属性进行统计或筛选，并能直接导出筛选结果。                                                         | 支持裸机资源的管理，录入裸机信息，包括裸机型号，架构，CPU/MEM/DISK信息，机架，序列号等，可添加属性，标签，所属的用户，管理员可分配裸机给相应的用户。                                                                                                                                      |
| 4    | 云平台管理能力     | ★支持查看所纳管私有云平台的管理服务，以及管理服务的物理拓扑，并能监控管理服务状态和性能指标。                                                                                                                              | 支持纳管openstack的云资源，查看openstack云资源目录树, openstack云资源概览查看主机，存储的使用情况                                                                                                                                                                                         |
|      |                    | ★支持同步所纳管私有云平台的基础管理架构；同步所纳管私有云平台的存量各类虚拟资源                                                                                                                                            | 支持openstack云资源同步操作, 同步openstack的主机，虚拟机，存储，卷，网络等信息，并可查看相应资源的使用情况                                                                                                                                                                                |
|      |                    | ★支持查看所纳管私有云平台的物理宿主机和数据存储的监控数据；支持查看所纳管私有云平台的存量各类虚拟资源的性能监控数据。                                                                                                      | 实时查看显示主机和虚拟机的负载情况、cpu使用率、内存使用率、硬盘使用率                                                                                                                                                                                                                     |
|      |                    | 支持接受所纳私有云平台的告警信息，并能对告警信息进行备注和处理，支持告警信息的压缩和自定义级别。                                                                                                                           | 可自定义告警的门限及相应的告警级别，设定通知方式，                                                                                                                                                                                                                                        |
| 5    | 运营管理           | ★支持容量规划与建议，对基础设施平台进行容量分析，对虚拟资源使用率进行分析，给出适当操作建议。                                                                                                                              | 查询统计指定时间段内宿主机和虚机的CPU、内存、磁盘的最小及最大使用率，可以给出云资源虚机数量、CPU用量、内存用量、磁盘用量趋势图，并给出适当建议                                                                                                                                            |
|      |                    | ★组织机构管理，支持按照实际运维管理架构设置任意层级的组织机构树，并可对组织机构树进行增、删、改、查操作。                                                                                                                  | 组织信息及上下级关系的增删改查，组织架构目录树的展示，组织资源配额的增删改查，组织内用户基本信息、审批权限、虚机资源的查询和组织内用户的删除，组织批量导入                                                                                                                                |
|      |                    | ★用户管理，支持用户的创建、删除、更改所属组织机构、编辑用户信息、重置密码等操作。                                                                                                                                          | 用户基本信息、组织信息职位信息、审批权限的的增删改查，用户服务和资源信息的查看，用户信息批量导入                                                                                                                                                                                          |
|      |                    | ★角色权限管理，支持多种角色设置，不同角色具有不同权限。                                                                                                                                                                    | 角色权限管理，可以设置多种角色，不同角色具有不同权限，包括：菜单权限、资源权限、操作权限；系统菜单的增删改查；系统操作权限项的查询及编辑管理                                                                                                                                              |
|      |                    | ★审批流程管理，支持自定义任意级别的审批流程，并能为不同类型的申请操作定义不同的审批流程。可提供对应接口，方便企业内部审批系统对接。                                                                                        | 可以为自助服务设置不同的审批流程，如果对接第三方的OA系统，可提供定制服务                                                                                                                                                                                                                  |
|      |                    | ★项目/业务系统管理，支持创建项目/业务系统，并为项目/业务系统设置资源配额。支持项目/业务系统生命周期管理，可对项目/业务系统进行下线和删除。                                                                                 | 支持租户的设置，支持租户的资源配额的增删改查                                                                                                                                                                                                                                              |
|      |                    | 支持以服务目录方式提供不同基础设施平台的资源抽象方式，支持自定义服务目录的配置项，并可基于服务目录发布云服务。                                                                                                             | 支持发布为服务目录的虚机产品和中间件产品的增删改查及标签管理，可定义虚机产品和中间件产品, 提供用户自定义服务，像虚拟机的创建，虚拟机更新，虚拟机删除，数据盘创建，更新，延期等服务                                                                                                        |
| 6    | 统计分析及报表     | ★支持各类表格数据的筛选和导出下载，方便统计资源用量和二次加工。                                                                                                                                                            | 支持各类表格数据的导出                                                                                                                                                                                                                                                                    |
|      |                    | ★支持基础设施平台维度/项目/业务系统维度/组织机构维度的统计分析报表。                                                                                                                                                       | 支持主机，虚拟机，网络，镜像，存储的报表的导出，支持宿主机和虚拟的CPU、内存、磁盘的最小及最大使用率的统计和趋势图的报表，支持部门的资源使用情况的报表                                                                                                                                     |
|      |                    | 支持总览及仪表盘展示，可为不同角色定义满足该角色需求的总览及仪表盘视图；支持基础设施平台规模、虚拟资源用量、物理资源使用率、虚拟资源超卖比、业务系统排名、资源使用率排名、资源用量趋势、告警统计与趋势等数据的加工及展示。 | 支持总览及仪表盘展示，为不同角色显示相应的总览及仪表盘视图，为管理员显示平台的总的资源信息，主机资源使用情况，虚拟机资源使用情况，各个部门的资源使用情况，使用的趋势图，告警等。 为部门管理员展示部门的资源使用情况和人员使用情况，趋势图，告警等。为用户显示用户的资源使用情况，趋势图等 |
|      |                    | ★支持全部虚拟资源和物理资源的CPU使用率、内存使用率、硬盘使用率排名，并可将性能指标数据导出成csv文件，支持正排序、倒排序。                                                                                                  | 支持宿主机和虚拟的CPU、内存、磁盘的最小及最大使用率的统计和趋势图的报表，并可以导出报表                                                                                                                                                                                                   |
| 7    | 自服务平台         | ★支持申请创建各类虚拟资源，包括虚拟主机、虚拟硬盘、VPC/路由器、私有网络、公网IP、防火墙、负载均衡器、应用集群等。                                                                                                          | 支持自服务目录，包括计算类服务，存储类服务，网络类服务，用户可以自助申请各类虚拟资源服务                                                                                                                                                                                                  |
|      |                    | ★支持各类虚拟资源的自动部署，可按照申请单描述的资源配置进行自动部署，也支持管理员手工填写配置信息部署。                                                                                                                    | 支持自服务目录，包括计算类服务，存储类服务，网络类服务，用户可以自助申请各类虚拟资源，系统根据申请的配置信息进行自动部署，管理员在审批时也可以改变用户的配置信息                                                                                                                          |
| 8    | 运维管理           | ★支持对常用运维脚本进行保存与管理。                                                                                                                                                                                        | 支持脚本的管理，管理员可以上传和下载脚本                                                                                                                                                                                                                                                  |
|      |                    | ★支持创建运维任务，选择脚本和虚拟资源，制定运维任务运行计划，并对运维任务进行管理。                                                                                                                                        | 可以创建任务，选择脚本和虚拟机，执行任务，查看任务的执行状态和相应的执行日志                                                                                                                                                                                                              |
| 9    | 安全审计           | ★支持对所有用户的所有操作日志进行保存及审计，支持对关键安全信息的脱敏。                                                                                                                                                    | 支持所有用户的操作日志的查询，包含：操作人、操作行为、操作对象、操作IP、状态及时间，结果可导出                                                                                                                                                                                            |
|      |                    | ★支持用户登陆密码的加密保存和传输。                                                                                                                                                                                        | 用户的密码在数据库加密保存，使用的时候解密，日志中进行脱敏处理                                                                                                                                                                                                                            |
|      |                    | ★支持用户查看登陆历史，包括登陆IP地址、时间、登陆方式等。                                                                                                                                                                  | 操作日志的查询统计，包含：操作人、操作行为、操作对象、操作IP、状态及时间，结果可导出                                                                                                                                                                                                      |
| 10   | 系统管理           | ★支持对产品信息自定义，并可预览修改效果。                                                                                                                                                                                  | 支持自定义产品信息，包括系统信息、页面图标、联系信息的配置                                                                                                                                                                                                                                |
|      |                    | 支持对影响系统运行的运维相关参数进行自定义，如临时文件保存时间、缓存失效时间、用户session失效时间等。                                                                                                                      | 支持系统功能参数的增删改查                                                                                                                                                                                                                                                                |
| 11   | 其他非功能性要求   | 系统采用微服务架构进行构建，便于功能模块的变更或新加，以及单个模块的水平扩展。                                                                                                                                             | 系统使用AngularJS+SpringBoot框架, 方便扩展和构建                                                                                                                                                                                                                                          |
|      |                    | ★系统可提供高可用部署，并可进行集群水平扩展，保证系统的稳定运行。                                                                                                                                                          | 系统提供高可用部署，方便扩展                                                                                                                                                                                                                                                              |
|      |                    | ★系统可提供自动化安装或升级脚本，保证系统部署和升级的安全和操作简单。                                                                                                                                                      | 系统支持一键自动安装，可提供自动化的升级脚本。                                                                                                                                                                                                                                            |

### 2.2.2 云管平台的特色功能

| 序号 | 功能需求   | 功能描述                                                                                                     |
|------|------------|--------------------------------------------------------------------------------------------------------------|
| 1    | 中间件服务 | 支持常用的各种中间件类的自助服务，包括数据库类，WEB服务类，消息类，负载均衡类，监控类等。                    |
| 2    | 系统公告   | 支持系统公告，管理员可以发布公告消息，所有人可以查看                                                         |
| 3    | 工单服务   | 支持工单服务，可以进行管理，工单的申请，工单的流程，已经查看等管理                                           |
| 4    | 批量操作   | 支持批量操作和设置，例如虚机批量的开机、关机、重启，批量设置虚拟机所属组织、用户等                           |
| 5    | 标签管理   | 支持标签管理，可以设置标签，给相应的资源打标签，并通过标签进行查看                                           |
| 6    | 数据盘服务 | 支持数据盘，可以查看数据盘详细查看：容量、状态、盘快照及操作历史，进行数据盘挂载，盘快照，删除、修改租期操作 |
| 7    | 虚拟机类型 | 支持配置虚拟机类型，类似公有云的虚拟机类型                                                                   |
| 8    | 公有云支持 | 支持主流公有云，阿里云，腾讯云和华为云                                                                       |
| 9    | 私有云支持 | 支持华为的fusionsphere私有云平台， xen平台                                                                   |

### 2.2.3 定制开发需求

# **3. 云管理平台详细功能说明**

## 3.1 我的工作台需求说明

| **功能项** | **功能描述**                                                                                                                                             |
|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| 待办审批   | 查看我的代办，查看申请的信息以及当前的状态，对我的代办进行审批操作，例如虚拟机申请的审批，存储卷的审批等，只有具有审批权限的人有这个功能。               |
| 我的申请   | 查看我的申请，查看申请的内容以及当前的状态，以及历史的申请的列表和详细信息                                                                               |
| 待办工单   | 查看我的工单的代办，查看工单的信息以及当前的状态，对我的工单代办进行审批操作，工单是流程的流转，管理员在线下做相应的处理。只有具有审批权限的人有这个功能 |
| 异常申请   | 查看异常的申请，例如因为底层的云平台的错误导致的申请错误，管理员查看后可以做相应的手工处理                                                               |
| 配额警告   | 部门设置了资源配额，当配额达到门限值时，发出警告。管理员可以给部门增加配额或对部门管理员发出告警                                                         |
| 最新公告   | 系统公告消息及通知信息展示及查看，例如管理员可以通过发出公告信息，例如新的产品上线信息，让所有的用户看到这个信息                                         |
| 最近操作   | 近期操作日志信息展示及查看，也可以查看所有的历史日志信息。例如虚拟机创建，删除等信息                                                                     |

![](media/image5.png)

### 3.1.1 代办审批

查看我的代办，查看申请的信息以及当前的状态，对我的代办进行审批操作，例如虚拟机申请的审批，存储卷的审批等，只有具有审批权限的人有这个功能

![](media/image6.png)

### 3.1.2 我的申请

查看我的申请，查看申请的内容以及当前的状态，以及历史的申请的列表和详细信息，也可以从这里发起新的服务申请

![](media/image7.png)

### 3.1.3 代办工单

查看我的工单的代办，查看工单的信息以及当前的状态，对我的工单代办进行审批操作，工单是流程的流转，管理员在线下做相应的处理。只有具有审批权限的人有这个功能

![](media/image8.png)

### 3.1.4 异常申请

查看异常的申请，例如因为底层的云平台的错误导致的申请错误，管理员查看后可以做相应的手工处理



### 3.1.5 配额警告

部门设置了资源配额，当配额达到门限值时，发出警告。管理员可以给部门增加配额或对部门管理员发出告警

### 3.1.6 最新公告

系统公告消息及通知信息展示及查看，例如管理员可以通过发出公告信息，例如新的产品上线信息，让所有的用户看到这个信息



### 3.1.7 最近操作

近期操作日志信息展示及查看，也可以查看所有的历史日志信息。例如虚拟机创建，删除等信息



## 3.2 管理目录需求说明

| **功能模块** | **功能项**       | **功能描述**                                                                                                                                                                         |
|--------------|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 组织管理     | 组织管理         | 组织以及组织的上下级关系的创建，删除，修改和查询。组织架构目录树的展示，表明组织的归属关系。                                                                                         |
|              | 组织配额         | 组织资源配额的设置，管理员给组织分配配额，组织管理员和用户可以在配额内申请资源。超出配额后，不允许申请资源。需要为组织增加配额。通过配额管理，管理员可以控制资源的合理的分配和使用。 |
|              | 用户管理         | 组织内用户列表以及基本信息的查看，和组织内用户的删除                                                                                                                                 |
|              | 组织信息批量导入 | 组织信息的批量的导入导出，以及组织模板下载，管理员可以下载模板，编辑组织信息，通过批量导入，开始设置组织架构                                                                         |
| 用户管理     | 用户列表         | 组织内用户列表查看，以及详细信息，包括用户名，密码，邮箱，电话，在组织中的职位以及是否有审批权限， 用户的编辑，删除。                                                                |
|              | 用户查看         | 用户的资源的占用信息查看，例如cpu/mem/disk, vm数量，卷数量等，                                                                                                                       |
|              | 用户信息批量导入 | 用户信息的批量的导入导出，以及用户模板下载，管理员可以下载模板，编辑用户信息，批量导入用户信息                                                                                       |
| 申请管理     | 申请管理         | 所有申请的查看，可以查看申请的详细信息，包括，申请的流程，状态，审批情况，自动执行情况等                                                                                             |

### 3.2.1 组织管理

组织以及组织的上下级关系的创建，删除，修改和查询。组织架构目录树的展示，表明组织的归属关系。



### 3.2.2 组织配额管理

组织资源配额的设置，管理员给组织分配配额，组织管理员和用户可以在配额内申请资源。超出配额后，不允许申请资源。需要为组织增加配额。通过配额管理，管理员可以控制资源的合理的分配和使用。



### 3.2.3 组织用户管理

组织内用户列表以及基本信息的查看，和组织内用户的删除。



### 3.2.3 组织信息批量导入

组织信息的批量的导入导出，以及组织模板下载，管理员可以下载模板，编辑组织信息，通过批量导入，开始设置组织架构:



### 3.2.4 用户列表

组织内用户列表查看，以及详细信息，包括用户名，密码，邮箱，电话，在组织中的职位以及是否有审批权限， 用户的编辑，删除：



### 3.2.7 用户查看

用户的资源的占用信息查看，例如cpu/mem/disk, vm数量，卷数量等：



### 3.2.8 用户信息批量导入

用户信息的批量的导入导出，以及用户模板下载，管理员可以下载模板，编辑用户信息，批量导入用户信息：



### 3.2.9 申请管理

所有申请的查看，可以查看申请的详细信息，包括，申请的流程，状态，审批情况，自动执行情况等：



## 3.3 自服务需求说明



### 3.3.1 计算类服务

虚拟机申请：列出管理员配置的虚拟机产品，用户选择相应的虚拟机产品，输入需要的参数，系统会发起流程审批，审批通过后，系统自动创建虚拟机，在用户的资源列表中可以看到新的虚拟机。用户可以使用自己设置的密码，登录使用。



虚拟机变更：申请变更用户拥有的虚拟机的CPU, 内存和磁盘大小，系统会发起流程审批，审批通过后，系统自动更新虚拟机的CPU, 内存和磁盘，在用户的资源列表中可以看到虚拟机的配置变更。 注意：如果云平台不支持动态虚拟机的配置变更，需要先停止虚拟机。

虚拟机租期：此功能涉及租期服务，当申请新虚拟机时，用户会设置一个虚拟机租期，租期到期后，系统会自动回收虚拟机，租期服务可以保证资源的高效使用，避免私有云常常出现的资源长期被占用问题。如果客户的使用场景不需要租期服务，可以关闭

### 3.3.2 存储类服务

数据盘申请：用户选择相应的云平台，输入需要的数据盘大小，系统会发起流程审批，审批通过后，系统自动创建虚拟数据盘，在用户的资源列表中可以看到新的数据盘。需要使用时，用户可以挂载数据盘到虚拟机，作为新的磁盘，虚拟机删除以后，数据盘不丢失，可以挂载到别的虚拟机继续使用，数据盘里的数据不丢失。保证数据的持久化  

数据盘变更：申请变更用户拥有的数据盘大小，系统会发起流程审批，审批通过后，系统自动更新数据盘大小，在用户的资源列表中可以看到数据盘的配置变更。

数据盘延期：此功能涉及租期服务，当申请数据盘时，用户会设置一个数据盘租期，租期到期后，系统会自动回收数据盘，租期服务可以保证资源的高效使用，避免私有云常常出现的资源长期被占用问题。如果客户的使用场景不需要租期服务，可以关闭

### 3.3.3 网络类服务

公网IP或者外网IP对云平台来说是关键资源，用户需要申请此资源，然后挂载到相应的虚拟机上使用，如果不使用，可以释放或挂载到别的虚拟机上。注意：此功能依赖于云平台的浮动IP服务，如果云平台不支持，不能使用。

### 3.3.2 中间件类服务

| **功能项**     | **功能描述**                                                                                                                                                   |
|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 数据库类服务   | 申请数据库类的服务，包括oracle, mysql, redis, mongo, zookeeper，审批完成后，系统将自动创建虚拟机，安装和配置相应的数据库。此服务可以根据客户的需求做定制和扩充 |
| WEB类服务      | 申请web类的服务，包括apache, tomcat, weblogic, was，审批完成后，系统将自动创建虚拟机，安装和配置相应的web服务器。此服务可以根据客户的需求做定制和扩充          |
| 消息类服务     | 申请消息类的服务，包括kafka, rabbitmq。 审批完成后，系统将自动创建虚拟机，安装和配置相应的消息类服务。此服务可以根据客户的需求做定制和扩充                     |
| 负载均衡类服务 | 申请负载均衡类的服务，包括nginx, haproxy, LVS。 审批完成后，系统将自动创建虚拟机，安装和配置相应的负载均衡类服务。此服务可以根据客户的需求做定制和扩充         |
| 监控类服务     | 申请监控类的服务，包括zabbix。 审批完成后，系统将自动创建虚拟机，安装和配置相应的监控服务。此服务可以根据客户的需求做定制和扩充                                |

### 3.3.2 工单服务

提交个性化服务申请，审批通过后由系统管理手动执行，并可展示工单状态

## 3.4 资源管理需求说明

### 3.4.1 数据中心管理

数据中心的创建：

数据中心的云资源的配置：

数据中心的资源概览，包括cpu, 内存，存储，主机，虚拟机信息:

数据中心的目录树结构，展示数据中心，到内部的云平台，到计算，存储，网络资源:

### 3.4.2 云资源管理

云平台资源的配置和纳管，支持vmware, openstack, fusionsphere, powervc, aliyun, aws, 腾讯云:

纳管的云平台的资源概览，包括cpu, 内存，存储，主机，虚拟机信息:

云平台目录树结构，展示云平台的计算，存储，网络资源：

### 3.4.3 主机管理

主机的列表及信息查看：

设置主机的CPU和内存的超配比：

主机详细信息查看：关联的虚拟机，存储、网络：

主机的监控：

主机标签：

主机的报表：

### 3.4.4 虚拟机管理

| 虚拟机管理 | 虚机列表、排序、查询及信息查看：虚机名称、配置、IP地址、状态、操作系统、到期时间所属用户                                         |
|------------|----------------------------------------------------------------------------------------------------------------------------------|
|            | 虚机详细信息查看：配置和规格、存储、网络、数据盘、应用软件、快照、操作历史、标签                                                 |
|            | 虚机运维操作：开机、关机、重启、挂起、唤醒、快照、捕获镜像、迁移、部署中间件、控制台、重命名、删除、新增网卡、绑定标签、修改租期 |
|            | 虚机运维批量操作：开机、关机、重启、挂起、唤醒、热迁移、删除、冷迁移（OpenStack）                                                |
|            | 虚机部署中间件                                                                                                                   |
|            | 虚机属性批量设置：所属组织、用户、项目、操作系统类型                                                                             |
|            | 虚机列表报表下载                                                                                                                 |
|            | 标签定义，标签绑定，基于标签的虚机查询                                                                                           |

虚机列表、排序、查询及信息查看：虚机名称、配置、IP地址、状态、操作系统、到期时间所属用户：

虚机详细信息查看：配置和规格、存储、网络、数据盘、应用软件、快照、操作历史、标签：

虚拟机监控：

虚机运维操作：开机、关机、重启、挂起、唤醒、快照、捕获镜像、迁移、部署中间件、控制台、重命名、删除、新增网卡、绑定标签、修改租期：

虚机运维批量操作：开机、关机、重启、挂起、唤醒、热迁移、删除、冷迁移（OpenStack）

虚机部署中间件：

虚机属性批量设置：所属组织、用户、项目、操作系统类型：

虚机列表报表下载：

标签定义，标签绑定，基于标签的虚机查询：

### 3.4.5 镜像管理

| 镜像管理 | 镜像信息列表及查询                     |
|----------|----------------------------------------|
|          | 镜像详细信息及虚机实际查看             |
|          | 镜像名称、操作系统、用户名及密码配置   |
|          | 标签定义，标签绑定，基于标签的镜像查询 |
|          | 镜像列表报表下载                       |

镜像信息列表及查询：

镜像详细信息及虚机实际查看：

镜像名称、操作系统、用户名及密码配置：

标签定义，标签绑定，基于标签的镜像查询：

镜像列表报表下载：

### 3.4.6 存储管理

| 存储管理 | 存储信息列表及查询                                 |
|----------|----------------------------------------------------|
|          | 存储详情查看：类型、容量、用量、关联主机信息的查看 |
|          | 标签定义，标签绑定，基于标签的存储查询             |

存储信息列表及查询：

存储详情查看：类型、容量、用量、关联主机信息的查看：

标签定义，标签绑定，基于标签的存储查询：

### 3.4.7 数据盘管理

| 数据盘管理 | 数据盘信息列表及查询                         |
|------------|----------------------------------------------|
|            | 数据盘详细查看：容量、状态、盘快照及操作历史 |
|            | 数据盘设置：名称、所属组织、项目及用户       |
|            | 数据盘挂载，盘快照，删除、修改租期           |
|            | 标签定义，标签绑定，基于标签的数据盘查询     |

数据盘信息列表及查询：

数据盘详细查看：容量、状态、盘快照及操作历史：

数据盘设置：名称、所属组织、项目及用户：

数据盘的操作，挂载，盘快照，删除、修改租期：

标签定义，标签绑定，基于标签的数据盘查询：

绑定标签

查看绑定的标签

### 3.4.8 网络管理

| 网络管理 | 网络信息列表及增删改查                             |
|----------|----------------------------------------------------|
|          | 子网信息列表及增删改查                             |
|          | 子网网关、子网掩码、DNS设置                        |
|          | 子网IP地址池增删改查，IP地址类型、状态，关联的虚机 |
|          | 网络信息报表下载                                   |

网络信息列表及增删改查：

子网信息列表及增删改查：

子网网关、子网掩码、DNS设置：

子网IP地址池增删改查，IP地址类型、状态，关联的虚机：

网络信息报表下载：

## 3.5 监控需求说明

| **功能项** | **功能描述**                                                                                        |
|------------|-----------------------------------------------------------------------------------------------------|
| 实施监控   | 可按区域、管理服务器、资源池、数据中心、集群、主机、虚拟机来查看资源的实时使用情况                  |
|            | 实时查看显示主机的负载情况、cpu使用率、内存使用率、硬盘使用率                                       |
|            | 实时查看显示虚拟机的负载情况、cpu使用率、内存使用率、硬盘使用率                                     |
|            | 实时监控信息可以导出                                                                                |
| top10      | 查看CPU、内存、硬盘、网络、负载率等参数TOP10宿主机及虚机统计列表                                    |
| 历史监控   | 按照数据中心、集群、主机、租户、项目、用户、时间区间，查询虚机CPU、内存、硬盘、网络的使用率及负载率 |
|            | 历史监控查询列表打印或导出，可导出为PDF或Excel格式                                                  |

### 3.5.1 实时监控

可按区域、管理服务器、资源池、数据中心、集群、主机、虚拟机来查看资源的实时使用情况：

实时查看显示主机的负载情况、cpu使用率、内存使用率、硬盘使用率：

实时查看显示虚拟机的负载情况、cpu使用率、内存使用率、硬盘使用率：

### 3.5.2 TOP10分析

查看CPU、内存、硬盘、网络、负载率等参数TOP10宿主机及虚机统计列表：

CPU TOP查看：

内存TOP查看：

磁盘TOP查看：

### 3.5.3 历史监控

## 3.6 分析功能需求说明

| **功能项** | **功能描述**                                                                              |
|------------|-------------------------------------------------------------------------------------------|
| 部门分析   | 查询统计部门用户数量、部门虚机数量及明细                                                  |
| 申请分析   | 查询统计服务申请的总量，用户服务申请数量及明细                                            |
| 资源分析   | 查询统计指定时间段内宿主机CPU、内存、磁盘的最小及最大使用率，结果可打印或导出为PDF、Excel |

### 3.6.1 部门分析

### 3.6.2 申请分析

### 3.6.3 资源分析

### 3.6.4 主机优化建议

## 3.7 系统管理需求说明

| 系统配置       |                                                                                                        |
|----------------|--------------------------------------------------------------------------------------------------------|
| 操作日志       | 操作日志的查询统计，包含：操作人、操作行为、操作对象、操作IP、状态及时间，结果可导出为Excel            |
| 系统参数       | 系统功能参数的增删改查                                                                                 |
| 定制管理       | 系统信息、页面图标、大屏默认地图及基本信息、联系信息的配置                                             |
| 系统健康检查   | 系统组件健康状况的检查，检查参数的增删改查                                                             |
| 服务配置       |                                                                                                        |
| 权限管理       | 角色权限管理，包括：菜单权限、资源权限、操作权限；系统菜单的增删改查；系统操作权限项的查询及编辑管理   |
| 虚拟机类型     | 虚机配置规格的增删改查                                                                                 |
| 虚拟机产品管理 | 可发布为服务目录的虚机产品的增删改查及标签管理，定义虚机产品时可指定资源池、集群、主机、镜像、网络配置 |
| 服务管理       | 服务目录的访问权限及审批流程管理                                                                       |

### 3.7.1 操作日志

### 3.7.2 系统参数

### 3.7.3 定制管理

### 3.7.4系统健康检查

### 3.7.5 权限管理

### 3.7.6 虚拟机类型管理

### 3.7.7 虚拟机产品

管理员需要先定义虚拟机产品，发布之后，用户可以申请虚拟机产品。虚拟机产品定义需要定义使用的云平台，计算，存储和网络信息。用户申请时不需要了解底层信息。

### 3.7.8 服务管理

# **4. 云管理平台定制开发功能需求说明**

## 4.1 用户申请表单需求说明

### 4.1.1 用户申请表单

根据农发行的当前用户申请需求，用户提出vmware虚拟机申请，提供虚拟机的规格需求信息，然后虚拟机管理员开始创建虚拟机，如果用户使用已有的vmware网络和IP， 用户将提供vmware网络信息, 虚拟机管理员可以根据这些信息直接创建虚拟机给用户，如果用户需要新的vmware网络和IP, 提出申请，网络管理员将提供相应的vmware网络和IP, 虚拟机管理员可以根据这些信息创建虚拟机给用户, 如果用户需要数据盘，提出申请， 存储管理员将提供vmware的存储信息，虚拟机管理员可以根据这些信息创建虚拟机给用户， 另外用户还会提供相应的安装软件的申请，例如安装oracle和weblogic在这个虚拟机上，管理员进行安装，然后提供给用户。

根据此需求，实现一次申请，根据申请的不同，走不同的审批分支， 并且提供足够的信息可以实现自动化的部署和配置，以下是用户申请表单的设计，包含了基本信息，虚拟机信息，软件信息。

### 4.1.2 用户申请表单详细说明

**申请基本信息**：

1.  用户名：申请的用户名

2.  部门信息：申请的用户的部门信息，这个信息将被设置到虚拟机的属性中，为后续的部门展示和部门的统计分析

3.  环境名称：可以理解成应用名称，可以通过应用的维度看到所有的虚拟机信息

4.  使用期限：此应用的使用期限，有长期和短期， 长期可以设置为永久有效，直到主动删除，短期可设置到期时间，到期后将自动删除。

**虚拟机信息：**

用户可以添加多个虚拟机在此应用环境里，为每个添加的虚拟机需要设置以下信息：

1.  云平台+集群： 虚拟机启动的云平台和相应的集群，有下拉框可以供用户选择，管理员可以设置列表。

2.  CPU核数：需要的CPU的核数， 比如4核

3.  MEM的大小：需要的内存的大小，以G为单位，比如2G

4.  DISK的大小：需要的系统盘的大小，以G为单位，比如200G, 当前的系统盘是在固定的共享存储上，此信息不需要让普通用户看到，管理员可以设置

5.  操作系统信息：操作系统的类型及其版本, 例如centos7

6.  访问密码：用户可以设置root/administrator的密码，此信息加密显示和保存。

7.  是否需要数据盘：如果用户需要数据盘，可以勾选，然后提供所需数据盘的大小，勾选后，审批流程将需要到存储管理员审批，存储管理员在审批中提供存储信息

8.  是否使用已有的网络/IP: 如果用户使用之前已经分的IP, 勾选，然后提供网络和IP信息，如果不勾选，审批流程将需要到网络管理员审批，网络管理员在审批中提供网络和IP信息信息

> 隐含信息：虚拟机的名称，为避免名称冲突，用户不需要提供，系统将使用用户名+UUID来表示，申请成功以后，可以从用户的页面中可以看到虚拟机及相应的虚拟机名称

**部署软件信息：**

用户可以部署多种软件在这个应用环境的虚拟机上，用户从软件列表中选择，管理员可以配置可用的软件列表。

1.  软件类型：用户选择的软件类型及版本，例如单机oracle 11.2.0.4

2.  软件的配置参数：软件安装配置需要的参数，用户需要提供，参数的列表需要讨论，暴露哪些参数给用户

3.  部署的目标虚拟机：选择前面虚拟机信息中提供的虚拟机，如果是软件集群部署，可设置提供多个虚拟机。根据管理员设定的支持的组合类型(操作系统+软件+版本)，用户只能选择组合中的类型，如果不满足，将返回此种部署不支持。例如组合列表中没有centos7+oracle+12.2, 用户之前设置了centos7的虚拟机，选oracle12.2， 部署的目标虚拟机将没有可用虚拟机。

注意：当前的软件部署组合列表信息基于当前农发行的部署需求，使用已有农发行当前的安装部署脚本，集成到云管的部署流程中。

## 4.2 软件部署需求说明

### 4.2.1 用户调研信息

为了解行里的平台软件的情况，进行了调研，调研情况如下：

**运行一处的信息**：



**运行二处的信息**：



### 4.2.2 调研信息分析

1.  当前的操作系统，平台软件类型和版本众多，很多软件和操作系统版本比较老

2.  很多平台软件没有频繁安装的需求，安装一次以后，就没有再重新安装过，从运行二处的信息，平台软件都不需要重新安装，平台一处的很多也不需要重新安装。

3.  针对平台软件类型和版本众多，当前行里出台了新核心应用系统规范，规范了平台软件的种类和最低版本，当前的需求考虑了规范

4.  原则是利用已有农发行当前的安装部署脚本，集成到云管的部署流程中。但当前调研的信息，基本都是需要手动安装，没有自动化的脚本。

5.  根据持续改进的原则，我们会挑选在新核心应用系统规范，重新安装使用频率比较高的组合作为开发需求。

6.  在选出的组合中，因为安装及其配置比较复杂，我们将收集行里如何使用和配置，开发相应的安装部署脚本，和相关人员讨论，测试脚本，在加入到云管平台的管理中，还有安装部署脚本需要的参数，哪些参数是必须暴露给用户的页面的，这些都需要讨论。

7.  这里应该需要大量的脚本开发工作。

8.  目标是实现规范化和脚本自动化

### 软件部署需求

基于和平台一处和二处的沟通，和现有调研信息的分析，得出以下的软件自动部署需求。基本使用最新的软件版本



以上是组合列表的需求，要用好和规范好软件很重要，未来会沟通进一步实现规范化和脚本自动化，将当前的合理配置固化下来。之后会细化参数和部署方式，因为安装和配置以及涉及的第三方的部分比较复杂，比如存储，网络，后续我们将收集行里如何使用和配置，开发相应的安装部署脚本，和相关人员讨论，测试脚本，满足处里的需求，然后加入到云管平台的管理中，另外还有安装部署脚本需要的参数，哪些参数是必须暴露给用户的页面的，这些都需要后续讨论和进一步细化。

## 4.3 审批流程定制需求说明

### 4.3.1 审批流程定制需求

根据农发行当前的申请流程，云管平台将提供以下的开发定制的申请审批流程：

### 4.3.2 审批流程定制需求详细说明

详细流程说明：

1.  用户登录云管系统，在自动服务页面，开始申请流程，根据页面提示，填写基本信息，虚拟机信息，软件部署信息，详细的申请表信息，请参见用户申请表单需求说明。提交申请后，流转到虚拟机管理员审批，用户可以查看申请状态

2.  虚拟机管理员登录云管系统，查看申请表，如果认为不合适，可以拒绝，并给出建议。将流转到用户，用户可以改变申请信息，再次提交。如果没有问题，虚拟机管理员可以通过审批，将流转到下一个节点。

3.  如果申请表提供使用新的网络和IP, 将流转到网络管理员审批。网络管理员登录云管系统，查看申请表，如果认为不合适，可以拒绝，并给出建议。将流转到用户，用户可以改变申请信息，再次提交， 流转到虚拟机管理员。如果没有问题，网络管理员可以通过审批，并且在申请单上提供新的网络和IP信息，然后将流转到下一个节点

4.  如果申请表提供使用数据盘, 将流转到存储管理员审批。存储管理员登录云管系统，查看申请表，如果认为不合适，可以拒绝，并给出建议。将流转到用户，用户可以改变申请信息，再次提交， 流转到虚拟机管理员。如果没有问题，存储管理员可以通过审批，并且在申请单上提供后端存储信息，然后将流转到下一个节点

5.  开始系统的自动任务，分析申请单中的基本信息，虚拟机信息，部署软件信息开始部署。调用资源管理模块生成新的虚拟机，并进行配置。然后根据部署软件信息，调用部署模块开始软件安装配置，全部成功以后，流程结束。如果失败，发信息给管理员，进行人工处理。

## 4.4 页面定制需求说明

根据客户的使用习惯，会对页面进行一定的开发定制，可能的一些定制需求包括：

1.  用户管理页面

2.  用户的概览页面，资源概览，通知等

3.  用户的自服务申请页面

4.  审批页面

5.  软件部署管理页面

这个页面的定制工作将在后续的测试中，根据反馈，逐步改进。

## 4.5 统计报表定制需求说明

当前统计报表提供基本的统计报表功能，包括虚拟机和主机的资源使用情况，部门的虚拟机的使用情况，申请的情况等，通常会根据客户关注的信息进行定制开发。

这个统计报表的定制工作将在后续的测试中，根据反馈，逐步改进。
